apiVersion: extensions/v1beta1
kind: Deployment
metadata:
  name: pulseaudio
spec:
  replicas: 1
  template:
    metadata:
      labels:
        app: pulseaudio
    spec:
      containers:
      - name: pulseaudio
        image: jess/pulseaudio
        # image: debian
        # command:
        # - "/bin/bash"
        # - "-xc"
        # - >
        #   apt-get update;
        #   apt-get install -y --no-install-recommends pulseaudio;
        #   pulseaudio --system --disallow-exit --disallow-module-loading
        imagePullPolicy: Always
        ports:
        - name: rtp-tcp
          containerPort: 5004
          protocol: TCP
        - name: rtp-udp
          containerPort: 5004
          protocol: UDP
        - name: pulseaudio
          containerPort: 4317
        # readinessProbe:
        #   tcpSocket:
        #     port: 5004
        #   failureThreshold: 1
        #   initialDelaySeconds: 20
        #   periodSeconds: 10
        #   successThreshold: 1
        #   timeoutSeconds: 2
        # livenessProbe:
        #   tcpSocket:
        #     port: 5004
        #   failureThreshold: 3
        #   initialDelaySeconds: 20
        #   periodSeconds: 10
        #   successThreshold: 1
        #   timeoutSeconds: 2
        volumeMounts:
        - name: current-config
          mountPath: /etc/pulse
        # - name: pulseaudio
        #   mountPath: /home/pulseaudio/.config/pulse/
        #   subPath: docker/pulseaudio
      volumes:
      # - name: pulseaudio
      #   glusterfs:
      #     endpoints: glusterfs-cluster
      #     path: data
      #     readOnly: false
      - name: current-config
        configMap:
          name: config.general.pulseaudio
